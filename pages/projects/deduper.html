---
template: main
---

<section id="deduper">

  <header>
    <h1>Email Deduper</h1>
  </header>

  <p class="instructions">
    Paste your email list into the top text area.
  </p>
  <p class="instructions">
    Need sample input?<br>
    Copy and paste from <a href="testemails.txt" target="_blank">this file</a>
  </p>

  <section id="controls">
    <div>
      <label for="input">Input Email List</label><br>
      <textarea id="input" name="input" cols="30" rows="10" tabindex="1"></textarea>
    </div>
    <div id="activate">
      <button tabindex="2">Process List</button>
    </div>
    <div>
      <label for="results">Results</label><br>
      <textarea id="results" name="results" cols="30" rows="10" tabindex="3" disabled></textarea>
    </div>
  </section>

  <script>
    (function () {
      /**
      * dedupe
      *
      * Given a list of emails, return a list of the emails with the duplicates
      * removed in the original order of the input
      *
      * @param [string] emails The array of email strings to dedupe
      * @returns [string] An array of emails from the original input with the
      *    duplicates removed
      */
      var dedupe = function (emails) {
        // Data structure to help us determine membership within a set
        var seenBefore = {};

        // "In Order" constraint maintained since Array.prototype.filter
        // processes linearly through an array
        return emails.filter(function (email) {
          // Check to see if our set already contains this entry
          if (seenBefore[email]) {
            // Exclude the email if we have already seen it
            return false;
          } else {
            // If we have not yet seen it before, add it to our set
            seenBefore[email] = true;
            // Include the email in the output
            return true;
          }
        });
      };

      // Grab references to our DOM input/output elements
      var input   = document.getElementById('input'),
          results = document.getElementById('results'),
          button  = document.querySelector('#activate button'),

          /**
          * runDeduper
          *
          * Collects and prepares DOM input and calls the deduper function
          * Also sets the result to the output DOM element
          */
          runDeduper = function () {
                // Get the raw data from the textarea
            var rawData = input.value,
                // Turn it into an array of lines
                emails  = rawData.split('\n'),
                // Process the list for duplicates
                deduped = dedupe(emails);

            // Set the results to the output textarea
            results.value = deduped.join('\n');
          },

          /**
          * activateButton
          *
          * Enables the button control to run the dedupe function
          * NOTE: This exists because the copy/paste operation for 100,000
          * lines of input on some browsers takes longer than the processing
          * itself!
          */
          activateButton = function (evt) {
            button.disabled = false;

            if (evt && evt.preventDefault) {
              evt.preventDefault();
              evt.stopPropagation();
            }
          };

      // Fire deduping when the user clicks the button
      button.onclick = runDeduper;
    }());
  </script>
</section>
